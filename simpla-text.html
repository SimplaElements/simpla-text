<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-text"> <template> <style>:host{display:block}:host([contenteditable]){outline:0}:host([inline]){display:inline}</style> <slot></slot> </template> <script>!function(){"use strict";var t="simpla-text-editor.html",e=document.createElement("simpla-text-toolbar"),i="_editor",n={properties:{commands:{type:Array,computed:"_computeCommands(plaintext)"}},observers:["_checkEditorPrepped(editable, commands, inline)","_refreshEditableOnEditor(editable)"],getEditor:function(){return this[i]},loadEditor:function(){var t=this;return Promise.resolve(this[i]||this._createEditor()).then(function(e){return t[i]=e,e})},runCommand:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadEditor().then(function(i){return i.runCommand(t,e)})},_createEditor:function(){var i=this;return this.__waitForEditor||(this.__waitForEditor=new Promise(function(e,n){var o=i.resolveUrl(t);i.importHref(o,e,n)}).then(function(){var t=window.SimplaText,n=t.Editor,o=t.formatters,r=function(t){return o[t]};return new n({dom:i,inline:i.inline,formatters:i.commands.map(r),placeholder:i.placeholder,formatterChangedCallback:function(t,n){var o=t.name,r=n.applied,a=n.meta;i.loadEditor().then(function(t){e.target===t&&(i._tools=i._tools||{},i._tools[o]={applied:r,meta:a},e.set?(e.set("tools."+o+".active",r),e.set("tools."+o+".meta",a)):(e.tools=e.tools||{},e.tools[o]={applied:r,meta:a}))})},selectCallback:function(t){i.fire("select",{selection:t}),e.parentElement!==document.body&&document.body.appendChild(e),e.range=t&&t.rangeCount&&t.getRangeAt(0),i._tools&&(e.tools=i._tools),t&&i.loadEditor().then(function(t){e.target=t})},inputCallback:function(){return i.fire("input")},editableCallback:function(){return i.editable}})})),this.__waitForEditor},_refreshEditableOnEditor:function(){var t=this.getEditor();t&&t.view.updateState(t.state)},_checkEditorPrepped:function(t){t&&this.loadEditor()},_computeCommands:function(t){return t?[]:["bold","italic","underline","link"]}},o=["h1","h2","h3","h4","h5","h6","p","li","dd","figcaption","mark","q","s","time","u","legend","option","b","big","i","small","tt","abbr","acronym","cite","pre","code","dfn","em","kbd","strong","samp","var","a","span","sub","sup","button","label"],r={properties:{inline:{type:Boolean,reflectToAttribute:!0}},attached:function(){this._autoSetMode()},_autoSetMode:function(){var t=this.parentElement&&this.parentElement.nodeName.toLowerCase();"undefined"==typeof this.inline&&(this.inline=o.indexOf(t)!==-1)}},a={properties:{path:{type:String,observer:"_observePath"}},listeners:{input:"_setToSimpla"},attached:function(){this._attached=!0,this._observers={editable:this._observeAndInitEditable(),path:this.path&&this._observeAndInitPath()}},detached:function(){var t=this;this._attached=!1,Object.keys(this._observers||{}).forEach(function(e){return t._observers[e]&&t._observers[e].unobserve()})},_observeAndInitEditable:function(){var t=this;return"undefined"==typeof this.editable&&(this.editable=Simpla.getState("editable")),Simpla.observeState("editable",function(e){t.editable=e})},_observeAndInitPath:function(){var t=this,e=function(e){return t._restoreFromSimpla(e)};return Simpla.get(this.path).then(e),Simpla.observe(this.path,e)},_observePath:function(t){this._attached&&(this._observers.path&&this._observers.path.unobserve(),t&&(this._observers.path=this._observeAndInitPath()))},_restoreFromSimpla:function(t){t&&this.value!==t.data.text&&(this.value=t.data.text,this.fire("contentload"))},_setToSimpla:function(){this.path&&Simpla.set(this.path,{type:"Text",data:{text:this.value}})}},s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function(){function t(){s(this,t)}return l(t,[{key:"beforeRegister",value:function(){this.is="simpla-text",this.properties={plaintext:{type:Boolean,value:!1},placeholder:{type:String,value:"Enter your text..."},editable:{type:Boolean,notify:!0,reflectToAttribute:!0},active:{type:Boolean,notify:!0,readOnly:!0,value:!1}},this.listeners={tap:"_handleTap",blur:"_handleBlur",focus:"_handleFocus"}}},{key:"_handleBlur",value:function(){this._setActive(!1)}},{key:"_handleFocus",value:function(){this.editable&&this._setActive(!0)}},{key:"_handleTap",value:function(){this.editable&&this._setActive(!0)}},{key:"_editableObserver",value:function(t){t||this._setActive(!1)}},{key:"behaviors",get:function(){return[n,r,a]}},{key:"value",get:function(){var t=this.getEditor();return t?t.getHTML():this.innerHTML},set:function(t){var e=this.getEditor();e?e.setHTML(t):this.innerHTML=t}}]),t}();Polymer(u)}()</script> </dom-module> 