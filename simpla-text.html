<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../simpla-element-behavior/simpla-element-behavior.html"> <dom-module id="simpla-text"> <template> <style>:host{display:block}:host([contenteditable]){outline:0}:host([inline]){display:inline}</style> <slot></slot> </template> <script>!function(){"use strict";var t=document.createElement("simpla-text-toolbar"),e={properties:{commands:{type:Array,computed:"_computeCommands(plaintext)"}},observers:["_checkEditorPrepped(editable, commands, inline)","_refreshEditableOnEditor(editable)"],getEditor:function(){return this._editor},loadEditor:function(){var t=this;return Promise.resolve(this._editor||this._createEditor()).then(function(e){return t._editor=e,e})},runCommand:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadEditor().then(function(n){return n.runCommand(t,e)})},_createEditor:function(){var e=this;return this.__waitForEditor||(this.__waitForEditor=new Promise(function(t,n){var i=e.resolveUrl("simpla-text-editor.html");e.importHref(i,t,n)}).then(function(){var n=window.SimplaText,i=n.Editor,o=n.formatters,a=function(t){return o[t]};return new i({dom:e,inline:e.inline,formatters:e.commands.map(a),placeholder:e.placeholder,formatterChangedCallback:function(n,i){var o=n.name,a=i.applied,r=i.meta;e.loadEditor().then(function(n){t.target===n&&(e._tools=e._tools||{},e._tools[o]={applied:a,meta:r},t.set?(t.set("tools."+o+".active",a),t.set("tools."+o+".meta",r)):(t.tools=t.tools||{},t.tools[o]={applied:a,meta:r}))})},selectCallback:function(n){var i=n&&e.editable&&!e.plaintext;e.fire("select",{selection:n}),t.parentElement!==document.body&&document.body.appendChild(t),t.range=i&&n.rangeCount&&n.getRangeAt(0),e._tools&&(t.tools=e._tools),n&&e.loadEditor().then(function(e){t.target=e})},inputCallback:function(){return e.fire("input")},editableCallback:function(){return e.editable}})})),this.__waitForEditor},_refreshEditableOnEditor:function(){var t=this.getEditor();t&&t.view.updateState(t.state)},_checkEditorPrepped:function(t){t&&this.loadEditor()},_computeCommands:function(t){return t?[]:["bold","italic","underline","link"]}},n=["h1","h2","h3","h4","h5","h6","p","li","dd","figcaption","mark","q","s","time","u","legend","option","b","big","i","small","tt","abbr","acronym","cite","pre","code","dfn","em","kbd","strong","samp","var","a","span","sub","sup","button","label"],i={properties:{inline:{type:Boolean,reflectToAttribute:!0}},attached:function(){this._autoSetMode()},_autoSetMode:function(){var t=this.parentElement&&this.parentElement.nodeName.toLowerCase();void 0===this.inline&&(this.inline=-1!==n.indexOf(t))}},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r={type:"Text",updateOn:["input"],setCallback:"_setToSimpla",getCallback:"_getFromSimpla"},l=function(){function t(){o(this,t)}return a(t,[{key:"beforeRegister",value:function(){this.is="simpla-text",this.properties={plaintext:{type:Boolean,value:!1},placeholder:{type:String,value:"Enter your text..."},editable:{type:Boolean,notify:!0,reflectToAttribute:!0},active:{type:Boolean,notify:!0,readOnly:!0,value:!1}},this.listeners={tap:"_handleTap",blur:"_handleBlur",focus:"_handleFocus"}}},{key:"_handleBlur",value:function(){this._setActive(!1)}},{key:"_handleFocus",value:function(){this.editable&&this._setActive(!0)}},{key:"_handleTap",value:function(){this.editable&&this._setActive(!0)}},{key:"_editableObserver",value:function(t){t||this._setActive(!1)}},{key:"_getFromSimpla",value:function(t){this.value!==t.data.text&&(this.value=t.data.text)}},{key:"_setToSimpla",value:function(){Simpla.set(this.path,{type:"Text",data:{text:this.value}})}},{key:"behaviors",get:function(){return[SimplaBehaviors.Element(r),e,i]}},{key:"value",get:function(){var t=this.getEditor();return t?t.getHTML():this.innerHTML},set:function(t){var e=this.getEditor();e?e.setHTML(t):this.innerHTML=t}}]),t}();Polymer(l)}()</script> </dom-module> 