<!-- Test Helpers -->
<script>
  function flushEditor(component, callback = () => {}) {
    return Promise.resolve()
      .then(() => component.loadEditor())
      .then((editor) => {
        if (editor.view.inDOMChange) {
          editor.view.inDOMChange.finish();
        }

        callback();
      });
  }

  function wait(time = 25) {
    return () => new Promise((resolve) => setTimeout(resolve, time));
  }

  function waitForLoaded(component) {
    return new Promise(resolve => {
      let handler = function(event) {
        if (event.detail.value) {
          resolve();
          component.removeEventListener('loaded-changed', handler);
        }
      }

      component.addEventListener('loaded-changed', handler);
    });
  }

  Object.assign(window, { flushEditor, wait, waitForLoaded });
</script>

<!-- Setup Simpla -->
<script src="https://unpkg.com/simpla@^2.0.0"></script>
<script>
  Simpla.init('local');
</script>
